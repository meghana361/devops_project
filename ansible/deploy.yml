- name: Docker â†’ Kubernetes deployment using Ansible
  hosts: local
  vars:
    image_tag: "{{ lookup('env','BUILD_NUMBER') }}"
  tasks:
    - name: Build Docker image
      command: docker build -t webapp:{{ image_tag }} .
      args:
        chdir: ..

    - name: Load image into Minikube
      command: minikube image load webapp:{{ image_tag }}

    - name: Update deployment image
      command: kubectl set image deployment/webapp-deployment webapp=webapp:{{ image_tag }}
